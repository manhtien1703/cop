import sys
import csv

# Hàm xử lý file cổ phiếu
def process_file(file_path, ticker, nyse_tickers):
    if ticker in nyse_tickers:
        for line in sys.stdin:  # Đọc từ stdin (điều này giúp đọc input từ Hadoop)
            data = line.strip().split(',')
            open_price = float(data[1])  # Giá Open
            close_price = float(data[4])  # Giá Close

            if open_price > close_price:
                print(f'{ticker}\t1')

# Đọc stock_info.csv từ stdin
def load_nyse_tickers():
    nyse_tickers = set()
    for line in sys.stdin:  # Đọc từ stdin
        row = line.strip().split(',')
        if row[0] == 'NYSE':  # Chỉ lấy các công ty trên NYSE
            nyse_tickers.add(convert_ticker_name(row[1]))  # Chỉ lấy Ticker
    return nyse_tickers

# Mapper function
def mapper():
    nyse_tickers = load_nyse_tickers()  # Tải ticker thuộc NYSE
    for line in sys.stdin:  # Đọc từ input
        ticker = line.strip().split('.')[0]
        process_file(ticker)

if __name__ == "__main__":
    mapper()






import sys

# Reducer function
def reducer():
    current_ticker = None
    count = 0

    for line in sys.stdin:
        ticker, value = line.strip().split('\t')

        if current_ticker == ticker:
            count += int(value)
        else:
            if current_ticker:
                # In ra ticker khi có giá Open > Close
                print(f'{current_ticker}\t{count}')
            current_ticker = ticker
            count = int(value)

    # In ticker cuối cùng
    if current_ticker:
        print(f'{current_ticker}\t{count}')

if __name__ == "__main__":
    reducer()
