import os
import csv
import sys

# Hàm chuyển đổi tên file sang ticker
def convert_ticker_name(ticker):
    return ticker.replace('.', '-').lower()

# Đọc stock_info.csv và chỉ lấy các cổ phiếu thuộc NYSE
def load_nyse_tickers():
    nyse_tickers = set()
    with open('stock_info.csv', 'r') as file:
        reader = csv.DictReader(file)
        for row in reader:
            if row['Exchange'] == 'NYSE':  # Chỉ lấy các công ty trên NYSE
                nyse_tickers.add(convert_ticker_name(row['Ticker']))
    return nyse_tickers

# Hàm mapper
def mapper():
    nyse_tickers = load_nyse_tickers()  # Tải ticker thuộc NYSE
    stock_folder = 'Stocks'  # Thư mục chứa các file cổ phiếu

    # Duyệt qua tất cả các file trong folder Stocks
    for file_name in os.listdir(stock_folder):
        ticker = file_name.split('.')[0]  # Lấy tên file, bỏ phần .us.txt
        if ticker in nyse_tickers:  # Chỉ xử lý nếu ticker thuộc NYSE
            with open(os.path.join(stock_folder, file_name), 'r') as file:
                next(file)  # Bỏ qua dòng tiêu đề
                for line in file:
                    data = line.strip().split(',')
                    open_price = float(data[1])  # Giá Open
                    close_price = float(data[4])  # Giá Close

                    # Nếu giá Open > Close, phát ra (ticker, 1)
                    if open_price > close_price:
                        print(f'{ticker}\t1')

if __name__ == "__main__":
    mapper()





import sys

# Reducer function
def reducer():
    current_ticker = None
    count = 0

    for line in sys.stdin:
        ticker, value = line.strip().split('\t')

        if current_ticker == ticker:
            count += int(value)
        else:
            if current_ticker:
                # In ra ticker khi có giá Open > Close
                print(f'{current_ticker}\t{count}')
            current_ticker = ticker
            count = int(value)

    # In ticker cuối cùng
    if current_ticker:
        print(f'{current_ticker}\t{count}')

if __name__ == "__main__":
    reducer()
